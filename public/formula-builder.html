<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สร้างสูตรยาขั้นสูง</title>
    <link rel="stylesheet" href="css/output.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="JS/app-config.js"></script>
</head>
<body class="bg-gray-100 py-10 px-4">
    <div class="container mx-auto max-w-4xl bg-white p-8 rounded-xl shadow-lg">
        <a href="doctor-dashboard.html" class="text-blue-600 hover:text-blue-800 mb-6 inline-flex items-center">
            <i class="fas fa-arrow-left mr-2"></i> กลับไปหน้าแดชบอร์ด
        </a>
        <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            <i class="fas fa-magic-wand-sparkles mr-2"></i> สร้างสูตรยาขั้นสูง (Advanced Formula Builder)
        </h2>

        <form id="addFormulaForm" class="space-y-6">
            <div class="space-y-4 border-b pb-6">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="formulaName" class="form-label">ชื่อสูตรยา:</label>
                        <input type="text" id="formulaName" class="form-input" required>
                    </div>
                    <div>
                        <label for="formulaVisibility" class="form-label">การมองเห็น:</label>
                        <select id="formulaVisibility" class="form-input" required>
                            <option value="private">ส่วนตัว (เห็นคนเดียว และใช้แชร์ได้)</option>
                            <option value="public">สาธารณะ (แพทย์/พยาบาลทุกคนเห็น)</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label for="formulaDetail" class="form-label">รายละเอียดสูตรยา:</label>
                    <textarea id="formulaDetail" class="form-input" rows="2"></textarea>
                </div>
                <div>
                    <label for="resultUnit" class="form-label">หน่วยของผลลัพธ์ (เช่น mcg/kg/min):</label>
                    <input type="text" id="resultUnit" class="form-input">
                </div>
            </div>

            <div class="border-b pb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">กำหนดตัวแปร (Inputs)</h3>
                <div id="variables-container" class="space-y-3 p-4 bg-gray-50 rounded-md border">
                    <p class="text-gray-500 text-center text-sm">เพิ่มตัวแปรที่ต้องใช้ในสูตร (เช่น น้ำหนัก, Rate, Max Dose)</p>
                </div>
                <button type="button" id="addVariableBtn" class="mt-3 action-button secondary"><i class="fas fa-plus mr-2"></i>เพิ่มตัวแปร</button>
            </div>

            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4">สร้าง Logic การคำนวณ</h3>
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button type="button" id="tab-dose" class="tab-button active">
                            <i class="fas fa-calculator mr-2"></i> สูตรคำนวณหลัก (Dose)
                        </button>
                        <button type="button" id="tab-rate" class="tab-button">
                             <i class="fas fa-tachometer-alt mr-2"></i> สูตรคำนวณ Rate สูงสุด
                        </button>
                    </nav>
                </div>

                <div id="componentPalette" class="mt-4 p-3 border rounded-md bg-green-50 flex flex-wrap gap-3 items-center">
                 <span class="font-semibold text-sm mr-2 text-green-800">ลากไปวาง:</span>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="*"><i class="fas fa-times"></i></button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="/"><i class="fas fa-divide"></i></button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="+"><i class="fas fa-plus"></i></button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="-"><i class="fas fa-minus"></i></button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="<"> &lt; </button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value=">"> &gt; </button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="operator" data-value="==="> = </button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="constant" data-value="0">ค่าคงที่</button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="parenthesis" data-value="(">(</button>
                    <button type="button" class="palette-button draggable p-2 text-sm"draggable="true" data-type="parenthesis" data-value=")">)</button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="conditional"><i class="fas fa-question-circle mr-1"></i>เงื่อนไข (IF)</button>
                    <button type="button" class="palette-button draggable p-2 text-sm" draggable="true" data-type="string"><i class="fas fa-quote-left mr-1"></i>ข้อความ</button>
                </div>

                <div id="tab-content-dose" class="tab-panel active">
                    <div id="builder-area-dose" class="builder-area">
                        <p class="placeholder-text">ลากองค์ประกอบมาวางเพื่อสร้าง "สูตรคำนวณหลัก"</p>
                    </div>
                    <p id="preview-dose" class="formula-preview"></p>
                </div>
                <div id="tab-content-rate" class="tab-panel">
                    <div id="builder-area-rate" class="builder-area">
                        <p class="placeholder-text">ลากองค์ประกอบมาวางเพื่อสร้าง "สูตรคำนวณ Rate สูงสุด"</p>
                    </div>
                     <p id="preview-rate" class="formula-preview"></p>
                </div>
                <div class="mt-6 p-4 border-2 border-dashed rounded-lg bg-gray-50 space-y-4">
    <h3 class="text-lg font-semibold text-gray-700">ตรวจสอบสูตร (Live Feedback)</h3>
    
    <div>
        <label class="form-label font-medium">Preview สูตรที่ได้:</label>
        <div id="live-preview-area" class="formula-preview bg-white border min-h-[40px] flex items-center"></div>
    </div>

    <div>
        <label class="form-label font-medium">ทดสอบการคำนวณ:</label>
        <div class="p-4 border rounded-md bg-white space-y-3">
            <div id="sample-inputs-container" class="grid grid-cols-2 gap-4">
                <p class="text-sm text-gray-500 col-span-2">กรุณากำหนดตัวแปร (Inputs) ก่อน</p>
            </div>
            <div class="border-t pt-3">
                <p class="text-sm text-gray-600">ผลลัพธ์ตัวอย่าง:</p>
                <p id="sample-result-display" class="text-2xl font-bold text-blue-600"></p>
            </div>
        </div>
    </div>
</div>
            </div>
            
            <p id="formMessage" class="form-message"></p>
            <button type="submit" class="action-button primary w-full mt-6 text-lg"><i class="fas fa-save mr-2"></i> บันทึกสูตรยา</button>
        </form>
    </div>

    <script src="JS/formula-builder.js"></script>
</body>
</html>